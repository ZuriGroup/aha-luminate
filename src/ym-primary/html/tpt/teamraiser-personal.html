<div ng-controller="PersonalPageCtrl" ng-cloak>
  <div class="ym-page-section ym-page-section__top">
    <div class="col-md-6 ym-user-image" ng-init="personalPagePhoto1.customUrl = '[[C4:graphic_upload]]'; personalPagePhoto1.caption = '[[T6:[[C1:graphic_caption]]]]'" ng-style="{'background-image': (personalPagePhoto1.customUrl && personalPagePhoto1.customUrl != '') ? ('url(' + personalPagePhoto1.customUrl + ')') : ('url(' + personalPagePhoto1.defaultUrl + ')')}">
      <div class="ym-user-image-inner">
        <div class="ym-school-student-survivor" ng-if="survivor">
          <img src="../[[?xx::x[[S80:dev_branch]]x::::[[S80:dev_branch]]/]]aha-luminate/dist/ym-primary/image/heart_hero.png" alt="I am a Survivor">
        </div>
        [[?
          [[?xx::x[[S1:cons_id]]x::::
            [[?x[[S1:cons_id]]x::x[[S334:px]]x::T::]]
          ]]
        ::T::
          <button type="button" class="btn btn-md-wide btn-toggle" ng-click="editPersonalPhoto1()">
            <span class="fa fa-camera"></span> Edit Photo
          </button>
        ::]]
        <img class="hidden-md hidden-lg" ng-src="{{personalPagePhoto1.customUrl && personalPagePhoto1.customUrl != '' ? personalPagePhoto1.customUrl : personalPagePhoto1.defaultUrl}}" alt="{{personalPagePhoto1.caption != '' ? personalPagePhoto1.caption : 'Student Photo'}}" ng-cloak>
      </div>
      <div class="caption" ng-if="personalPagePhoto1.caption && personalPagePhoto1.caption != ''" ng-cloak>
        <span ng-bind-html="personalPagePhoto1.caption"></span>
      </div>
    </div>
    <div class="col-md-6 ym-progress ym-secondary-medium-color">
      <h2 class="ym-progress__title h4">
        Help me raise more lifesaving donations
      </h2>
      <a aria-label="Donate to help me raise funds" class="btn btn-primary btn-lg" href="Donation2?df_id=[[E42:[[S80:trID]]:form-id]]&amp;FR_ID=[[S80:trID]]&amp;PROXY_ID=[[S334:px]]&amp;PROXY_TYPE=20">
        Donate
      </a>
      <div class="ym-progress__thermometer" name="Personal Progress Bar" aria-valuetext="{{personalProgress.percent}} percent of fundraising progress" role="progressbar" aria-label="" aria-valuenow="{{personalProgress.percent}}" aria-valuemin="0" aria-valuemax="100">
        <div class="ym-progress__thermometer--fill" ng-style="{'width': personalProgress.percent + '%'}"></div>
      </div>
      <div class="ym-progress__stats">
        <div class="ym-progress__amount col-sm-6">
          <p>
            I've raised <strong>[[E130:"[[E48:[[S80:trID]]-[[S334:px]]:dollars]]" ".00" "" replaceall]]</strong>
          </p>
        </div>
        <div class="ym-progress__goal col-sm-6">
          <p>
            My goal is <strong>[[E130:"[[E48:[[S80:trID]]-[[S334:px]]:goal]]" ".00" "" replaceall]]</strong>
          </p>
        </div>
        <div class="clearfix"></div>
        <div class="ym-progress__date" ng-if="eventDate && eventDate != '' && eventDate != 'User Provided No Response'" ng-cloak>
          <p>
            My event date is <strong><span ng-bind-html="eventDate"></span></strong>
          </p>
        </div>
      </div>
    </div>
    <div class="clearfix"></div>
  </div>
  <div class="ym-page-section ym-page-section__main">
    <div class="ym-story" ng-class="prizes.length > 0 || challengeId != null ? 'col-md-6' : 'col-md-12'">
      <h2 class="ym-headline h3">
        My Story
      </h2>
      [[?
        [[?xx::x[[S1:cons_id]]x::::
          [[?x[[S1:cons_id]]x::x[[S334:px]]x::T::]]
        ]]
      ::T::
        <div class="ym-story-edit-btns">
          <button type="button" class="btn btn-md-wide btn-toggle" ng-click="editPersonalPageContent()" ng-if="personalPageContent.mode == 'view'">
            <span class="fa fa-pencil"></span> Edit Story
          </button>
          <div ng-if="personalPageContent.mode == 'edit'" ng-cloak>
            <button type="button" class="btn btn-md-wide btn-primary" ng-click="savePersonalPageContent()">
              <span class="fa fa-pencil"></span> <strong>Save Story</strong>
            </button> 
            <button type="button" class="btn btn-md-wide btn-toggle" ng-click="resetPersonalPageContent()">
              Cancel
            </button>
          </div>
        </div>
      ::]]
      <div class="hidden js--default-page-content" hidden aria-hidden="true" ng-non-bindable>
        [[C6:fr_rich_text]]
      </div>
      <div ng-show="personalPageContent.mode == 'view'">
        <img class="personal-avatar" ng-src='{{personalInfo.avatar}}' ng-if="personalInfo.avatar != ''" alt="Avatar for [[E48:[[S80:trID]]-[[S334:px]]:cons.first_name]] [[E130:[[T8:[[E48:[[S80:trID]]-[[S334:px]]:cons.last_name]]]] 0 1 substring]]." ng-cloak>
        <div ng-bind-html="personalPageContent.rich_text">
          <div ng-non-bindable>
            [[C6:fr_rich_text]]
          </div>
        </div>
      </div>
      [[?
        [[?xx::x[[S1:cons_id]]x::::
          [[?x[[S1:cons_id]]x::x[[S334:px]]x::T::]]
        ]]
      ::T::
        <div class="ym-page-content-editor" ng-show="personalPageContent.mode == 'edit'" ng-cloak>
          <label for="taHtmlElement{{personalPageContent.serial}}" class="sr-only">Edit your personal story:</label>
          <div text-angular name="ng_rich_text" ng-model="personalPageContent.ng_rich_text" ta-toolbar="{{personalPageContent.textEditorToolbar}}" serial="{{personalPageContent.serial}}"></div>
        </div>
      ::]]
    </div>
    <div class="col-md-6 ym-user-interactions" ng-if="prizes.length > 0 || studentChallengeBadge || schoolChallengeBadge || challengeId != null">
      <div class="ym-badges" ng-if="prizes.length > 0 || studentChallengeBadge || schoolChallengeBadge">
        <h2 class="ym-headline h3">
          Check Out My Badges
        </h2>
        <div class="ym-badges__item" ng-if="prizesEarned == prizes.length && prizes.length != 0"  ng-cloak>
          <div class="ym-badge__item">
            <img class="img-responsive" src="../[[?xx::x[[S80:dev_branch]]x::::[[S80:dev_branch]]/]]aha-luminate/dist/ym-primary/image/fy22/badge_Finns_Mission.png" alt="Finn's Mission is Completed">
            <span>Completed Finn's Mission!</span> <span class="sr-only">(earned)</span>
          </div>
        </div>
        <div class="ym-badges__item" ng-repeat="prize in prizes | filter: {status: 1}" ng-cloak> <!--  ng-repeat="prize in prizes | limitTo: 3" -->
          <div class="ym-badge__item" ng-if="prize.earned" ng-cloak>
            <img class="img-responsive" ng-src="//cd-aha-oot-production.s3.amazonaws.com/fy21/assets/badges/khc/{{prize.id}}_delivered.png" alt="{{prize.label}}">
            <span ng-bind-html="prize.label"></span> <span class="sr-only">(earned)</span>
          </div>
        </div>
        <div class="ym-badges__item" ng-if="studentChallengeBadge" ng-cloak>
          <div class="ym-badge__item" ng-cloak>
            <img class="img-responsive" ng-src="../[[?xx::x[[S80:dev_branch]]x::::[[S80:dev_branch]]/]]aha-luminate/dist/ym-primary/image/fy22/badge-challenge-student.png" alt="Individual School Challenge Completed">
            Individual School Challenge Completed <span class="sr-only">(earned)</span>
          </div>
        </div>
        <div class="ym-badges__item" ng-if="schoolChallengeBadge" ng-cloak>
          <div class="ym-badge__item" ng-cloak>
            <img class="img-responsive" ng-src="../[[?xx::x[[S80:dev_branch]]x::::[[S80:dev_branch]]/]]aha-luminate/dist/ym-primary/image/fy22/badge-challenge-school.png" alt="School Goal Challenge Completed">
            School Goal Challenge Completed <span class="sr-only">(earned)</span>
          </div>
        </div>
        <div class="clearfix"></div>
      </div>
      <div class="ym-my-challenge ym-secondary-medium-color" ng-if="challengeId != null" ng-cloak>
        <h2 class="ym-headline">
          My Challenge
        </h2>
        <div class="row challenge-day-streak">
          <div class="col-sm-4">
            <img class="img-responsive" ng-if="challengeId == 1" src="../[[?xx::x[[S80:dev_branch]]x::::[[S80:dev_branch]]/]]aha-luminate/dist/ym-primary/image/fy22/badge-kind.png" alt="{{challengeName}}" ng-cloak>
            <img class="img-responsive" ng-if="challengeId == 2" src="../[[?xx::x[[S80:dev_branch]]x::::[[S80:dev_branch]]/]]aha-luminate/dist/ym-primary/image/fy22/badge-active.png" alt="{{challengeName}}" ng-cloak>
          </div>
          <div class="col-sm-8" ng-if="challengeCompleted > 0" ng-cloak>
            <p class="ym_my_challenge__stats">
              I have a
              <span class="challenge-day-count">{{challengeCompleted}}</span>
              day streak
              <span ng-if="challengeId == '1'" ng-cloak>for being kind!</span>
              <span ng-if="challengeId == '2'" ng-cloak>for being active!</span>
            </p>
          </div>
        </div>
        <div class="clearfix"></div>
      </div>
      <!-- fallback to pull challenge from LO if no Zuri data -->
      [[?[[E48:[[S80:trID]]-[[S334:px]]:question:Pick from one of the choices below and we will customize your message letting friends and family know you have taken the challenge. We will also send you some information to help you meet your goal.]]::::
      ::
        <div class="ym-my-challenge ym-secondary-medium-color" ng-if="challengeId == null" ng-cloak>
          <h2 class="ym-headline">
            My Challenge
          </h2>
          <div class="col-sm-4">
            <img class="img-responsive" src="../[[?xx::x[[S80:dev_branch]]x::::[[S80:dev_branch]]/]]aha-luminate/dist/ym-primary/image/fy21/badge-grateful.png" alt="">
          </div>
          <div class="col-sm-8">
            <p class="ym_my_challenge__description">
              <strong>[[E48:[[S80:trID]]-[[S334:px]]:question:Pick from one of the choices below and we will customize your message letting friends and family know you have taken the challenge. We will also send you some information to help you meet your goal.]]</strong>
            </p>
          </div>
          <div class="clearfix"></div>
        </div>
      ]]
      <div class="clearfix"></div>
    </div>
    <div class="clearfix"></div>
  </div>
  <div class="ym-page-section ym-page-section__list ym-accent-color">
    <div class="ym-donate-cta" ng-class="personalDonors.donors.length < 1 ? 'col-sm-12' : 'col-sm-6'">
      <h2 class="h5">
        Donate to [[E48:[[S80:trID]]-[[S334:px]]:cons.first_name]]
      </h2>
      <div ng-if="personalDonors.donors.length > 0" ng-cloak>
        <p>
          <strong>Add your name to the list!</strong>
        </p>
      </div>
      <div ng-if="personalDonors.donors.length < 1" ng-cloak>
        <p>
          <strong>Be the first to donate!</strong>
        </p>
      </div>
      <a aria-label="Donate to [[E48:[[S80:trID]]-[[S334:px]]:cons.first_name]]" class="btn btn-primary btn-lg" href="Donation2?df_id=[[E42:[[S80:trID]]:form-id]]&amp;FR_ID=[[S80:trID]]&amp;PROXY_ID=[[S334:px]]&amp;PROXY_TYPE=20">
        Donate
      </a>
    </div>
    <div class="ym-list" ng-class="!personalDonors.donors || personalDonors.donors.length == 0 ? 'hidden' : 'col-sm-6'" role="list" aria-label="Top Donors List" ng-cloak>
      <h2>
        <img class="img-responsive" src="../[[?xx::x[[S80:dev_branch]]x::::[[S80:dev_branch]]/]]aha-luminate/dist/ym-primary/image/fy22/top-fundraising-fy22.png" alt="Saluting these top donors:">
      </h2>
      <ul class="ym-donor-list">
        <li class="ym-donor-list__row" ng-repeat="personalDonor in personalDonors.donors" role="listitem" ng-if="personalDonors.donors.length > 0" ng-cloak>
          <div class="clearfix">
            <span class="ym-donor-list__row--name">{{personalDonor.name}}</span> 
            <span class="ym-donor-list__row--amount">{{personalDonor.amountFormatted}}</span>
          </div>
        </li>
      </ul>
    </div>
    <div class="clearfix"></div>
  </div>
  <div class="hidden" hidden aria-hidden="true">
    <div class="js--personal-donors">
      [[C5:fr_status_2]]
    </div>
  </div>
</div>
