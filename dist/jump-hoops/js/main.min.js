(function(){angular.module("ahaLuminateApp",["ngSanitize","ngTouch","ui.bootstrap","ahaLuminateControllers"]),angular.module("ahaLuminateControllers",[]),angular.module("ahaLuminateApp").constant("APP_INFO",{version:"1.0.0"}),angular.module("ahaLuminateApp").run(["$rootScope","APP_INFO",function(a,b){var c;if(c=angular.element("[data-aha-luminate-root]"),""!==c.data("api-key")&&(a.apiKey=c.data("api-key")),a.apiKey||new Error("AHA Luminate Framework: No Luminate Online API Key is defined."),""!==c.data("cons-id")&&(a.consId=c.data("cons-id")),""!==c.data("auth-token")&&(a.authToken=c.data("auth-token")),""!==c.data("fr-id"))return a.frId=c.data("fr-id")}]),angular.element(document).ready(function(){var a,b;a=["ahaLuminateApp"];try{angular.module("trPcApp"),a.push("trPcApp")}catch(a){b=a}return angular.bootstrap(document,a)}),angular.module("ahaLuminateApp").factory("AuthService",["LuminateRESTService",function(a){return{login:function(b,c){var d;return d="method=login",b&&""!==b&&(d+="&"+b),a.luminateExtendConsRequest(d,!1,c)}}}]),angular.module("ahaLuminateApp").factory("DonationService",["LuminateRESTService",function(a){return{getDonationFormInfo:function(b){var c;return c="method=getDonationFormInfo",b&&""!==b&&(c+="&"+b),a.donationRequest(c).then(function(a){return a})},donate:function(b){var c;return c="method=donate",b&&""!==b&&(c+="&"+b),a.donationRequest(c).then(function(a){return a})},startDonation:function(b){var c;return c="method=startDonation",b&&""!==b&&(c+="&"+b),a.donationRequest(c).then(function(a){return a})}}}]),angular.module("ahaLuminateApp").factory("LuminateRESTService",["$rootScope","$http","APP_INFO",function(a,b,c){return{request:function(c,d,e,f){if(d)if(a.apiKey){if(d+="&v=1.0&api_key="+a.apiKey+"&response_format=json&suppress_response_codes=true",!e||a.authToken)return e&&(d+="&auth="+a.authToken),f&&(d+="&fr_id="+a.frId+"&s_trID="+a.frId),b({method:"POST",url:c,data:d,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(a){return a})}else;else;},luminateExtendRequest:function(b,c,d,e,f){if(luminateExtend){if(c)return e&&(c+="&fr_id="+a.frId+"&s_trID="+a.frId),luminateExtend.api({api:b,data:c,requiresAuth:d,callback:f||angular.noop})}else;},teamraiserRequest:function(a,b,c){return this.request("CRTeamraiserAPI",a,b,c)},luminateExtendTeamraiserRequest:function(a,b,c,d){return this.luminateExtendRequest("teamraiser",a,b,c,d)},consRequest:function(a,b){return this.request("CRConsAPI",a,b,!1)},donationRequest:function(a){return this.request("CRDonationAPI",a)},luminateExtendConsRequest:function(a,b,c){return this.luminateExtendRequest("cons",a,b,!1,c)}}}]),angular.module("ahaLuminateApp").factory("TeamraiserCompanyService",["LuminateRESTService","$http","$sce",function(a,b,c){return{getCompanies:function(b,c){var d;return d="method=getCompaniesByInfo",b&&""!==b&&(d+="&"+b),a.luminateExtendTeamraiserRequest(d,!1,!0,c)},getCompanyList:function(b,c){var d;return d="method=getCompanyList",b&&""!==b&&(d+="&"+b),a.luminateExtendTeamraiserRequest(d,!1,!0,c)},getCoordinatorQuestion:function(a,c){return b({method:"GET",url:"PageServer?pagename=ym_coordinator_data&pgwrap=n&consId="+a+"&frId="+c}).then(function(a){return a})},getSchools:function(){var a,d;return a="http://www2.heart.org/site/PageServer?pagename=jump_hoops_school_search&pgwrap=n",d=c.trustAsResourceUrl(a),b.jsonp(d,{jsonpCallbackParam:"callback"}).then(function(a){return a})}}}]),angular.module("ahaLuminateApp").factory("TeamraiserParticipantService",["LuminateRESTService",function(a){return{getParticipants:function(b,c){var d;return d="method=getParticipants",b&&""!==b&&(d+="&"+b),a.luminateExtendTeamraiserRequest(d,!1,!0,c)}}}]),angular.module("ahaLuminateApp").factory("TeamraiserTeamService",["LuminateRESTService",function(a){return{getTeams:function(b,c){var d;return d="method=getTeamsByInfo",b&&""!==b&&(d+="&"+b),a.luminateExtendTeamraiserRequest(d,!1,!0,c)}}}]),angular.module("ahaLuminateControllers").controller("CompanyPageCtrl",["$scope","$rootScope","$location","$filter","$timeout","TeamraiserCompanyService","TeamraiserTeamService","TeamraiserParticipantService",function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n;return a.companyId=c.absUrl().split("company_id=")[1].split("&")[0],a.companyProgress=[],b.companyName="",a.eventDate="",a.totalTeams="",a.teamId="",l=function(b,c){if(a.companyProgress.amountRaised=b,a.companyProgress.amountRaised=Number(a.companyProgress.amountRaised),a.companyProgress.amountRaisedFormatted=d("currency")(a.companyProgress.amountRaised/100,"$").replace(".00",""),a.companyProgress.goal=c||0,a.companyProgress.goal=Number(a.companyProgress.goal),a.companyProgress.goalFormatted=d("currency")(a.companyProgress.goal/100,"$").replace(".00",""),a.companyProgress.percent=2,e(function(){var b;if(b=a.companyProgress.percent,0!==a.companyProgress.goal&&(b=Math.ceil(a.companyProgress.amountRaised/a.companyProgress.goal*100)),b<2&&(b=2),b>98&&(b=98),a.companyProgress.percent=b,!a.$$phase)return a.$apply()},500),!a.$$phase)return a.$apply()},k=function(){return f.getCompanies("company_id="+a.companyId,{success:function(c){var d,e,g,h,i;return a.totalTeams=c.getCompaniesResponse.company.teamCount,g=c.getCompaniesResponse.company.eventId,d=c.getCompaniesResponse.company.amountRaised,h=c.getCompaniesResponse.company.goal,i=c.getCompaniesResponse.company.companyName,e=c.getCompaniesResponse.company.coordinatorId,b.companyName=i,l(d,h),f.getCoordinatorQuestion(e,g).then(function(b){if(a.eventDate=b.data.coordinator.event_date,a.totalTeams=1)return a.teamId=b.data.coordinator.team_id})}})},k(),a.companyTeams=[],n=function(b,c){if(a.companyTeams.teams=b||[],c=c||0,a.companyTeams.totalNumber=Number(c),a.totalTeams=c,!a.$$phase)return a.$apply()},j=function(){return g.getTeams("team_company_id="+a.companyId,{success:function(a){var b,c;if(n(),b=a.getTeamSearchByInfoResponse.team)return angular.isArray(b)||(b=[b]),angular.forEach(b,function(a){var b;if(a.amountRaised=Number(a.amountRaised),a.amountRaisedFormatted=d("currency")(a.amountRaised/100,"$").replace(".00",""),b=a.joinTeamURL)return a.joinTeamURL=b.split("/site/")[1]}),c=a.getTeamSearchByInfoResponse.totalNumberResults,n(b,c)}})},j(),a.companyParticipants=[],m=function(b,c){if(a.companyParticipants.participants=b||[],c=c||0,a.companyParticipants.totalNumber=Number(c),!a.$$phase)return a.$apply()},(i=function(){return h.getParticipants("team_name="+encodeURIComponent("%%%")+"&first_name="+encodeURIComponent("%%%")+"&last_name="+encodeURIComponent("%%%")+"&list_filter_column=team.company_id&list_filter_text="+a.companyId+"&list_sort_column=total&list_ascending=false",{error:function(){if(m(),numCompaniesParticipantRequestComplete++,numCompaniesParticipantRequestComplete===numCompanies)return setCompanyNumParticipants(numParticipants)},success:function(a){var b,c,e,f;if(m(),c=null!=(e=a.getParticipantsResponse)?e.participant:void 0)return angular.isArray(c)||(c=[c]),b=[],angular.forEach(c,function(a){var c,e;if(null!=(e=a.name)?e.first:void 0)return a.amountRaised=Number(a.amountRaised),a.amountRaisedFormatted=d("currency")(a.amountRaised/100,"$").replace(".00",""),c=a.donationUrl,c&&(a.donationUrl=c.split("/site/")[1]),b.push(a)}),f=a.getParticipantsResponse.totalNumberResults,m(b,f)}})})()}]),angular.module("ahaLuminateControllers").controller("DonationCtrl",["$scope","$rootScope","DonationService",function(a,b,c){var d,e,f;return d=angular.element("[data-donation-form-root]"),a.donationInfo={validate:"true",form_id:d.data("formid"),fr_id:d.data("frid"),billing_text:angular.element("#billing_info_same_as_donor_row label").text()},a.donationLevels=[],c.getDonationFormInfo("form_id="+a.donationInfo.form_id+"&fr_id="+a.donationInfo.fr_id).then(function(b){var c;return c=b.data.getDonationFormInfoResponse.donationLevels.donationLevel,angular.forEach(c,function(b){var c,d,e,f,g,h,i;return g=b.level_id,c=b.amount.formatted,i=b.userSpecified,e="#level_standardexpanded"+g,d="level"+g,angular.element(e).parent().parent().parent().parent().addClass(d),h=angular.element("."+d).find(".donation-level-expanded-label p").text(),f=angular.element("."+d+" .donation-level-label-input-container input").prop("checked"),a.donationLevels.push({levelId:g,classLevel:d,amount:c,userSpecified:i,levelLabel:h,levelChecked:f})})}),a.giftType=function(a){var b;return b=angular.element(".generic-repeat-label-checkbox-container input").prop("checked"),"monthly"===a?(b===!1&&angular.element(".generic-repeat-label-checkbox-container input").click(),angular.element(".ym-donation-levels__type--onetime").removeClass("btn-toggle--selected"),angular.element(".ym-donation-levels__type--monthly").addClass("btn-toggle--selected")):(b===!0&&angular.element(".generic-repeat-label-checkbox-container input").click(),angular.element(".ym-donation-levels__type--onetime").addClass("btn-toggle--selected"),angular.element(".ym-donation-levels__type--monthly").removeClass("btn-toggle--selected"))},a.selectLevel=function(a){return angular.element(".ym-donation-levels__amounts .btn-toggle.btn-toggle--selected").removeClass("btn-toggle--selected"),angular.element(".ym-donation-levels__amounts .btn-toggle.level"+a).addClass("btn-toggle--selected"),angular.element(".ym-donation-levels__message").addClass("hidden"),angular.element(".ym-donation-levels__message.level"+a).removeClass("hidden"),angular.element(".donation-level-container.level"+a+" input").click()},f=function(){return angular.element("#employer_name_row").parent().addClass("employer-match"),angular.element("#employer_street_row").parent().addClass("employer-match"),angular.element("#employer_city_row").parent().addClass("employer-match"),angular.element("#employer_state_row").parent().addClass("employer-match"),angular.element("#employer_zip_row").parent().addClass("employer-match"),angular.element("#employer_phone_row").parent().addClass("employer-match"),angular.element(".employer-match").addClass("hidden")},f(),a.toggleEmployerMatch=function(){return angular.element(".employer-match").toggleClass("hidden")},e=function(){return angular.element("#billing_first_name_row").addClass("billing-info"),angular.element("#billing_last_name_row").addClass("billing-info"),angular.element("#billing_addr_street1_row").addClass("billing-info"),angular.element("#billing_addr_street2_row").addClass("billing-info"),angular.element("#billing_addr_city_row").addClass("billing-info"),angular.element("#billing_addr_state_row").addClass("billing-info"),angular.element("#billing_addr_zip_row").addClass("billing-info"),angular.element("#billing_addr_country_row").addClass("billing-info"),angular.element(".billing-info").addClass("hidden")},e(),a.toggleBillingInfo=function(){var a;return angular.element(".billing-info").toggleClass("hidden"),a=angular.element("#billing_info").prop("checked"),a===!0?angular.element("#billing_info_same_as_donorname").prop("checked","true"):angular.element("#billing_info_same_as_donorname").prop("checked","false")}}]),angular.module("ahaLuminateControllers").controller("MainCtrl",["$scope","$httpParamSerializer","AuthService",function(a,b,c){return a.toggleLoginMenu=function(){return a.loginMenuOpen?delete a.loginMenuOpen:a.loginMenuOpen=!0},angular.element("body").on("click",function(b){if(a.loginMenuOpen&&0===angular.element(b.target).closest(".ym-header-login").length&&a.toggleLoginMenu(),!a.$$phase)return a.$apply()}),a.headerLoginInfo={user_name:"",password:""},a.submitHeaderLogin=function(){return c.login(b(a.headerLoginInfo),{error:function(){return angular.element(".js--default-header-login-form").submit()},success:function(){return a.headerLoginInfo.ng_nexturl&&""!==a.headerLoginInfo.ng_nexturl?window.location=a.headerLoginInfo.ng_nexturl:window.location=window.location.href}})},a.toggleWelcomeMenu=function(){return a.welcomeMenuOpen?delete a.welcomeMenuOpen:a.welcomeMenuOpen=!0},angular.element("body").on("click",function(b){if(a.welcomeMenuOpen&&0===angular.element(b.target).closest(".ym-header-welcome").length&&a.toggleWelcomeMenu(),!a.$$phase)return a.$apply()}),a.toggleSiteMenu=function(){return a.siteMenuOpen?delete a.siteMenuOpen:a.siteMenuOpen=!0},angular.element("body").on("click",function(b){if(a.siteMenuOpen&&0===angular.element(b.target).closest(".ym-site-menu").length&&a.toggleSiteMenu(),!a.$$phase)return a.$apply()})}]),angular.module("ahaLuminateControllers").controller("PersonalPageCtrl",["$scope","$rootScope","$location","$filter","$timeout","TeamraiserParticipantService","TeamraiserCompanyService",function(a,b,c,d,e,f,g){var h,i,j,k;return h=angular.element("[data-aha-luminate-root]"),a.participantId=c.absUrl().split("px=")[1].split("&")[0],""!==h.data("company-id")&&(a.companyId=h.data("company-id")),""!==h.data("team-id")&&(a.teamId=h.data("team-id")),a.eventDate="",b.numTeams="",g.getCompanies("company_id="+a.companyId,{success:function(c){var d,e,f,h;return d=null!=(f=c.getCompaniesResponse)?f.company.coordinatorId:void 0,e=null!=(h=c.getCompaniesResponse)?h.company.eventId:void 0,b.numTeams=c.getCompaniesResponse.company.teamCount,g.getCoordinatorQuestion(d,e).then(function(b){return a.eventDate=b.data.coordinator.event_date})}}),k=function(b,c){var f;return a.personalProgress={amountRaised:b||0,goal:c||0},a.personalProgress.amountRaisedFormatted=d("currency")(a.personalProgress.amountRaised/100,"$").replace(".00",""),a.personalProgress.goalFormatted=d("currency")(a.personalProgress.goal/100,"$").replace(".00",""),0===a.personalProgress.goal?a.personalProgress.rawPercent=0:(f=Math.ceil(a.personalProgress.amountRaised/a.personalProgress.goal*100),f>100&&(f=100),a.personalProgress.rawPercent=f),a.personalProgress.percent=0,a.$$phase||a.$apply(),e(function(){var b;if(b=a.personalProgress.percent,0!==a.personalProgress.goal&&(b=Math.ceil(a.personalProgress.amountRaised/a.personalProgress.goal*100)),b>100&&(b=100),a.personalProgress.percent=b,!a.$$phase)return a.$apply()},500)},f.getParticipants("fr_id="+a.frId+"&first_name="+encodeURIComponent("%%")+"&last_name="+encodeURIComponent("%")+"&list_filter_column=reg.cons_id&list_filter_text="+a.participantId,{error:function(){return k()},success:function(a){var b,c;return b=null!=(c=a.getParticipantsResponse)?c.participant:void 0,b?k(Number(b.amountRaised),Number(b.goal)):k()}}),a.personalDonors={page:1},j=angular.element(".js--personal-donors .team-honor-list-row"),j&&0!==j.length?1===j.length&&0===j.eq(0).find(".team-honor-list-name").length?(a.personalDonors.donors=[],a.personalDonors.totalNumber=0):(angular.forEach(j,function(b,c){var e,f;return f=angular.element(b).find(".team-honor-list-name").text(),e=angular.element(b).find(".team-honor-list-value").text(),e=e&&e.indexOf("$")!==-1?100*Number(e.replace("$","").replace(/,/g,"")):-1,a.personalDonors.donors||(a.personalDonors.donors=[]),a.personalDonors.donors.push({name:f,amount:e,amountFormatted:e===-1?"":d("currency")(e/100,"$").replace(".00","")})}),a.personalDonors.totalNumber=j.length):(i=angular.element(".js--personal-donors .scrollContent p"),i&&0!==i.length?(angular.forEach(i,function(b,c){var e,f;return f=jQuery.trim(angular.element(b).html().split("<")[0]),e=jQuery.trim(angular.element(b).html().split(">")[1]),e=e&&e.indexOf("$")!==-1?100*Number(e.replace("$","").replace(/,/g,"")):-1,a.personalDonors.donors||(a.personalDonors.donors=[]),a.personalDonors.donors.push({name:f,amount:e,amountFormatted:e===-1?"":d("currency")(e/100,"$").replace(".00","")})}),a.personalDonors.totalNumber=i.length):(a.personalDonors.donors=[],a.personalDonors.totalNumber=0))}]),angular.module("ahaLuminateControllers").controller("SchoolSearchCtrl",["$scope","$rootScope","TeamraiserCompanyService",function(a,b,c){return c.getSchools({success:function(a){return console.log("get school"),console.log(a)}})}]),angular.module("ahaLuminateControllers").controller("TeamPageCtrl",["$scope","$location",function(a,b){return a.teamId=b.absUrl().split("team_id=")[1].split("&")[0]}]),angular.module("ahaLuminateApp").directive("companyParticipantList",function(){return{templateUrl:"../aha-luminate/dist/jump-hoops/html/directive/companyParticipantList.html",restrict:"E",replace:!0,scope:{companyName:"=",companyId:"=",frId:"=",participants:"="},controller:["$scope",function(a){return a.companyParticipantSearch={participant_name:""},a.toggleCompanyParticipantList=function(){return a.isOpen=!a.isOpen}}]}}),angular.module("ahaLuminateApp").directive("companyTeamList",function(){return{templateUrl:"../aha-luminate/dist/jump-hoops/html/directive/companyTeamList.html",restrict:"E",replace:!0,scope:{companyName:"=",companyId:"=",frId:"=",teams:"="}}})}).call(this);