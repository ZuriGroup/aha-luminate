(function(){angular.module("ahaLuminateApp",["ngSanitize","ui.bootstrap","ahaLuminateControllers"]),angular.module("ahaLuminateControllers",[]),angular.module("ahaLuminateApp").constant("APP_INFO",{version:"1.0.0"}),angular.module("ahaLuminateApp").run(["$rootScope","APP_INFO",function(n,o){var c;if(c=angular.element("[data-aha-luminate-root]"),""!==c.data("api-key")&&(n.apiKey=c.data("api-key")),n.apiKey||new Error("AHA Luminate Framework: No Luminate Online API Key is defined."),""!==c.data("cons-id")&&(n.consId=c.data("cons-id")),""!==c.data("auth-token")&&(n.authToken=c.data("auth-token")),""!==c.data("fr-id"))return n.frId=c.data("fr-id")}]),angular.element(document).ready(function(){var n,o;n=["ahaLuminateApp"];try{angular.module("trPcApp"),n.push("trPcApp")}catch(n){o=n}try{angular.module("trPageEditApp"),n.push("trPageEditApp")}catch(n){o=n}return angular.bootstrap(document,n)}),angular.module("ahaLuminateApp").factory("LuminateRESTService",["$rootScope","$http","APP_INFO",function(n,o,c){return{request:function(c,e,f,i){if(e)if(n.apiKey){if(e+="&v=1.0&api_key="+n.apiKey+"&response_format=json&suppress_response_codes=true",!f||n.authToken)return f&&(e+="&auth="+n.authToken),i&&(e+="&fr_id="+n.frId+"&s_trID="+n.frId),o({method:"POST",url:c,data:e,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(n){return n})}else;else;},luminateExtendRequest:function(o,c,e,f,i){if(luminateExtend){if(c)return f&&(c+="&fr_id="+n.frId+"&s_trID="+n.frId),luminateExtend.api({api:o,data:c,requiresAuth:e,callback:i||angular.noop})}else;},teamraiserRequest:function(n,o,c){return this.request("CRTeamraiserAPI",n,o,c)},luminateExtendTeamraiserRequest:function(n,o,c,e){return this.luminateExtendRequest("teamraiser",n,o,c,e)}}}]),angular.module("ahaLuminateApp").factory("TeamraiserCompanyService",["LuminateRESTService",function(n){return{getCompanies:function(o,c){var e;return e="method=getCompaniesByInfo",o&&""!==o&&(e+="&"+o),n.luminateExtendTeamraiserRequest(e,!1,!0,c)},getCompanyList:function(o,c){var e;return e="method=getCompanyList",o&&""!==o&&(e+="&"+o),n.luminateExtendTeamraiserRequest(e,!1,!0,c)}}}]),angular.module("ahaLuminateApp").factory("TeamraiserParticipantService",["LuminateRESTService",function(n){return{getParticipants:function(o,c){var e;return e="method=getParticipants",o&&""!==o&&(e+="&"+o),n.luminateExtendTeamraiserRequest(e,!1,!0,c)}}}]),angular.module("ahaLuminateApp").factory("TeamraiserTeamService",["LuminateRESTService",function(n){return{getTeams:function(o,c){var e;return e="method=getTeamsByInfo",o&&""!==o&&(e+="&"+o),n.luminateExtendTeamraiserRequest(e,!1,!0,c)}}}]),angular.module("ahaLuminateApp").directive("eqColumnHeight",["$window","$timeout",function(n,o){return{restrict:"A",link:function(c,e){var f;return f=function(){var n;return angular.element(e).css("height",""),angular.element(e).siblings("[eq-column-height]").css("height",""),n=Number(angular.element(e).css("height").replace("px","")),angular.element(e).siblings("[eq-column-height]").each(function(){var o;if(o=Number(angular.element(this).css("height").replace("px","")),o>n)return n=o}),angular.element(e).css("height",n+"px"),angular.element(e).siblings("[eq-column-height]").css("height",n+"px")},o(f,500),angular.element(n).bind("resize",function(){return f(),c.$digest()})}}}]),angular.module("ahaLuminateApp").directive("companyParticipantList",function(){return{templateUrl:"../aha-luminate/dist/heart-walk/html/directive/companyParticipantList.html",restrict:"E",replace:!0,scope:{isChildCompany:"=",companyName:"=",participants:"="}}}),angular.module("ahaLuminateApp").directive("companyTeamList",function(){return{templateUrl:"../aha-luminate/dist/heart-walk/html/directive/companyTeamList.html",restrict:"E",replace:!0,scope:{isChildCompany:"=",companyName:"=",teams:"="}}}),angular.module("ahaLuminateApp").directive("teamMemberList",function(){return{templateUrl:"../aha-luminate/dist/heart-walk/html/directive/teamMemberList.html",restrict:"E",replace:!0,scope:{teamMembers:"=",teamGiftsLabel:"=",teamGiftsAmount:"="}}}),angular.module("ahaLuminateApp").directive("topCompanyList",function(){return{templateUrl:"../aha-luminate/dist/heart-walk/html/directive/topCompanyList.html",restrict:"E",replace:!0,scope:{companies:"=",maxSize:"="}}}),angular.module("ahaLuminateApp").directive("topParticipantList",function(){return{templateUrl:"../aha-luminate/dist/heart-walk/html/directive/topParticipantList.html",restrict:"E",replace:!0,scope:{participants:"=",maxSize:"="}}}),angular.module("ahaLuminateApp").directive("topTeamList",function(){return{templateUrl:"../aha-luminate/dist/heart-walk/html/directive/topTeamList.html",restrict:"E",replace:!0,scope:{teams:"=",maxSize:"="}}}),angular.module("ahaLuminateControllers").controller("CompanyPageCtrl",["$scope","$location","$filter","TeamraiserCompanyService","TeamraiserTeamService","TeamraiserParticipantService",function(n,o,c,e,f,i){var j,l,r,t,u,y,C,Q,a,b,d,g,h,k,m,p;return n.companyId=o.absUrl().split("company_id=")[1].split("&")[0],r=angular.element(".js--default-company-summary"),y=r.find(".company-tally-container--gift-count .company-tally-ammount").text(),""===y&&(y="0"),n.companyProgress={numDonations:y},g=function(o,e){if(n.companyProgress.amountRaised=o||0,n.companyProgress.amountRaised=Number(n.companyProgress.amountRaised),n.companyProgress.amountRaisedFormatted=c("currency")(n.companyProgress.amountRaised/100,"$").replace(".00",""),n.companyProgress.goal=e||0,n.companyProgress.goal=Number(n.companyProgress.goal),n.companyProgress.goalFormatted=c("currency")(n.companyProgress.goal/100,"$").replace(".00",""),!n.$$phase)return n.$apply()},e.getCompanies("company_id="+n.companyId,{error:function(){return g()},success:function(n){var o,c;return o=null!=(c=n.getCompaniesResponse)?c.company:void 0,o?g(o.amountRaised,o.goal):g()}}),l=angular.element(".js--default-company-hierarchy"),j=l.find(".trr-td a"),n.childCompanies=[],angular.forEach(j,function(o){var c,e;if(e=angular.element(o).attr("href"),c=angular.element(o).text(),e.indexOf("company_id=")!==-1)return n.childCompanies.push({id:e.split("company_id=")[1].split("&")[0],name:c})}),C=n.childCompanies.length+1,n.companyTeams={page:1},p=function(o,c){if(n.companyTeams.teams=o||[],n.companyTeams.totalNumber=c||0,!n.$$phase)return n.$apply()},n.childCompanyTeams={companies:[]},u=function(o,c,e,f,i){var j,l;if(j=(null!=(l=n.childCompanyTeams.companies[o])?l.page:void 0)||0,n.childCompanyTeams.companies[o]={page:j,companyIndex:o,companyId:c||"",companyName:e||"",teams:f||[],totalNumber:i||0},!n.$$phase)return n.$apply()},k=function(o){if(n.companyProgress.numTeams=o||0,!n.$$phase)return n.$apply()},a=0,d=0,n.getCompanyTeams=function(){var o;return o=n.companyTeams.page-1,f.getTeams("team_company_id="+n.companyId+"&list_sort_column=total&list_ascending=false&list_page_size=5&list_page_offset="+o,{error:function(){if(p(),a++,a===C)return k(d)},success:function(n){var o,e,f;if(p(),o=null!=(e=n.getTeamSearchByInfoResponse)?e.team:void 0,o&&(angular.isArray(o)||(o=[o]),angular.forEach(o,function(n){var o;if(n.amountRaised=Number(n.amountRaised),n.amountRaisedFormatted=c("currency")(n.amountRaised/100,"$").replace(".00",""),o=n.joinTeamURL)return n.joinTeamURL=o.split("/site/")[1]}),f=n.getTeamSearchByInfoResponse.totalNumberResults,p(o,f),d+=Number(f)),a++,a===C)return k(d)}})},n.getCompanyTeams(),n.getChildCompanyTeams=function(o){var e,i,j,l,r;return e=n.childCompanies[o],i=e.id,j=e.name,l=null!=(r=n.childCompanyTeams.companies[o])?r.page:void 0,l?l--:l=0,f.getTeams("team_company_id="+i+"&list_sort_column=total&list_ascending=false&list_page_size=5&list_page_offset="+l,{error:function(){if(u(o,i,j),a++,a===C)return k(d)},success:function(n){var e,f,l;if(e=null!=(f=n.getTeamSearchByInfoResponse)?f.team:void 0,e?(angular.isArray(e)||(e=[e]),angular.forEach(e,function(n){var o;if(n.amountRaised=Number(n.amountRaised),n.amountRaisedFormatted=c("currency")(n.amountRaised/100,"$").replace(".00",""),o=n.joinTeamURL)return n.joinTeamURL=o.split("/site/")[1]}),l=n.getTeamSearchByInfoResponse.totalNumberResults,u(o,i,j,e,l),d+=Number(l)):u(o,i,j),a++,a===C)return k(d)}})},angular.forEach(n.childCompanies,function(o,c){return n.getChildCompanyTeams(c)}),n.companyParticipants={page:1},m=function(o,c){if(n.companyParticipants.participants=o||[],n.companyParticipants.totalNumber=c||0,!n.$$phase)return n.$apply()},n.childCompanyParticipants={companies:[]},t=function(o,c,e,f,i){var j,l;if(j=(null!=(l=n.childCompanyParticipants.companies[o])?l.page:void 0)||0,n.childCompanyParticipants.companies[o]={page:j,companyIndex:o,companyId:c||"",companyName:e||"",participants:f||[],totalNumber:i||0},!n.$$phase)return n.$apply()},h=function(o){if(n.companyProgress.numParticipants=o||0,!n.$$phase)return n.$apply()},Q=0,b=0,n.getCompanyParticipants=function(){var o;return o=n.companyParticipants.page-1,i.getParticipants("team_name="+encodeURIComponent("%%%")+"&list_filter_column=team.company_id&list_filter_text="+n.companyId+"&list_sort_column=total&list_ascending=false&list_page_size=5&list_page_offset="+o,{error:function(){if(m(),Q++,Q===C)return h(b)},success:function(n){var o,e,f,i;if(m(),e=null!=(f=n.getParticipantsResponse)?f.participant:void 0,e&&(angular.isArray(e)||(e=[e]),o=[],angular.forEach(e,function(n){var e,f;if(null!=(f=n.name)?f.first:void 0)return n.amountRaised=Number(n.amountRaised),n.amountRaisedFormatted=c("currency")(n.amountRaised/100,"$").replace(".00",""),e=n.donationUrl,e&&(n.donationUrl=e.split("/site/")[1]),o.push(n)}),i=n.getParticipantsResponse.totalNumberResults,m(o,i),b+=Number(i)),Q++,Q===C)return h(b)}})},n.getCompanyParticipants(),n.getChildCompanyParticipants=function(o){var e,f,j,l,r;return e=n.childCompanies[o],f=e.id,j=e.name,l=null!=(r=n.childCompanyParticipants.companies[o])?r.page:void 0,l?l--:l=0,i.getParticipants("team_name="+encodeURIComponent("%%%")+"&list_filter_column=team.company_id&list_filter_text="+f+"&list_sort_column=total&list_ascending=false&list_page_size=5&list_page_offset="+l,{error:function(){if(t(o,f,j),Q++,Q===C)return h(b)},success:function(n){var e,i,l,r;if(i=null!=(l=n.getParticipantsResponse)?l.participant:void 0,i?(angular.isArray(i)||(i=[i]),e=[],angular.forEach(i,function(n){var o,f;if(null!=(f=n.name)?f.first:void 0)return n.amountRaised=Number(n.amountRaised),n.amountRaisedFormatted=c("currency")(n.amountRaised/100,"$").replace(".00",""),o=n.donationUrl,o&&(n.donationUrl=o.split("/site/")[1]),e.push(n)}),r=n.getParticipantsResponse.totalNumberResults,t(o,f,j,e,r),b+=Number(r)):t(o,f,j),Q++,Q===C)return h(b)}})},angular.forEach(n.childCompanies,function(o,c){return n.getChildCompanyParticipants(c)})}]),angular.module("ahaLuminateControllers").controller("GreetingPageCtrl",["$scope","TeamraiserParticipantService","TeamraiserTeamService","TeamraiserCompanyService",function(n,o,c,e){var f,i,j;return n.topParticipants={},i=function(o){if(n.topParticipants.participants=o,!n.$$phase)return n.$apply()},o.getParticipants("first_name="+encodeURIComponent("%%%")+"&list_sort_column=total&list_ascending=false",{error:function(){return i([])},success:function(n){var o,c;return c=(null!=(o=n.getParticipantsResponse)?o.participant:void 0)||[],angular.isArray(c)||(c=[c]),i(c)}}),n.topTeams={},j=function(o){if(n.topTeams.teams=o,!n.$$phase)return n.$apply()},c.getTeams("list_sort_column=total&list_ascending=false",{error:function(){return j([])},success:function(n){var o,c;return c=(null!=(o=n.getTeamSearchByInfoResponse)?o.team:void 0)||[],angular.isArray(c)||(c=[c]),j(c)}}),n.topCompanies={},f=function(o){if(n.topCompanies.companies=o,!n.$$phase)return n.$apply()},e.getCompanyList("include_all_companies=true",{error:function(){return f([])},success:function(n){var o,c,i;return o=(null!=(c=n.getCompanyListResponse)?c.companyItem:void 0)||[],angular.isArray(o)||(o=[o]),i=[],angular.forEach(o,function(n){if("0"===n.parentOrgEventId)return i.push(n.companyId)}),e.getCompanies("list_sort_column=total&list_ascending=false&list_page_size=500",{error:function(){return f([])},success:function(n){var o,c,e;return o=(null!=(c=n.getCompaniesResponse)?c.company:void 0)||[],angular.isArray(o)||(o=[o]),e=[],angular.forEach(o,function(n){if(i.indexOf(n.companyId)>-1)return e.push(n)}),e.sort(function(n,o){return Number(o.amountRaised)-Number(n.amountRaised)}),f(e)}})}})}]),angular.module("ahaLuminateControllers").controller("MainCtrl",["$scope",function(n){return angular.element("body").on("click",".addthis_button_facebook",function(n){return n.preventDefault()})}]),angular.module("ahaLuminateControllers").controller("PersonalPageCtrl",["$scope",function(n){}]),angular.module("ahaLuminateControllers").controller("TeamPageCtrl",["$scope","$location","TeamraiserParticipantService",function(n,o,c){var e,f,i,j;return n.teamId=o.absUrl().split("team_id=")[1].split("&")[0],n.teamMembers={page:1},e=angular.element(".js--default-team-roster"),f=e.find(".team-roster-participant-row").last(),n.teamMembers.teamGiftsLabel=f.find(".team-roster-participant-name").text(),j=f.find(".team-roster-participant-raised").text(),""===j&&(j="0"),n.teamMembers.teamGiftsAmount=100*j.replace("$","").replace(/,/g,""),i=function(o,c){if(n.teamMembers.members=o||[],n.teamMembers.totalNumber=c||0,!n.$$phase)return n.$apply()},n.getTeamMembers=function(){var o;return o=n.teamMembers.page-1,c.getParticipants("first_name="+encodeURIComponent("%%%")+"&list_filter_column=reg.team_id&list_filter_text="+n.teamId+"&list_sort_column=total&list_ascending=false&list_page_size=4&list_page_offset="+o,{error:function(){return i()},success:function(n){var o,c,e;if(i(),e=null!=(o=n.getParticipantsResponse)?o.participant:void 0)return angular.isArray(e)||(e=[e]),c=[],angular.forEach(e,function(n){var o,e;if(null!=(e=n.name)?e.first:void 0)return o=n.donationUrl,o&&(n.donationUrl=o.split("/site/")[1]),c.push(n)}),i(c,n.getParticipantsResponse.totalNumberResults)}})},n.getTeamMembers()}])}).call(this);