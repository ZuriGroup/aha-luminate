(function(){angular.module("ahaLuminateApp",["ngSanitize","ui.bootstrap","ahaLuminateControllers"]),angular.module("ahaLuminateControllers",[]),angular.module("ahaLuminateApp").constant("APP_INFO",{version:"1.0.0"}),angular.module("ahaLuminateApp").run(["$rootScope","APP_INFO",function(n,o){var c;if(c=angular.element("[data-aha-luminate-root]"),""!==c.data("api-key")&&(n.apiKey=c.data("api-key")),n.apiKey||new Error("AHA Luminate Framework: No Luminate Online API Key is defined."),""!==c.data("cons-id")&&(n.consId=c.data("cons-id")),""!==c.data("auth-token")&&(n.authToken=c.data("auth-token")),""!==c.data("fr-id"))return n.frId=c.data("fr-id")}]),angular.element(document).ready(function(){var n,o;n=["ahaLuminateApp"];try{angular.module("trPcApp"),n.push("trPcApp")}catch(n){o=n}try{angular.module("trPageEditApp"),n.push("trPageEditApp")}catch(n){o=n}return angular.bootstrap(document,n)}),angular.module("ahaLuminateApp").factory("LuminateRESTService",["$rootScope","$http","APP_INFO",function(n,o,c){return{request:function(c,e,f,i){if(e)if(n.apiKey){if(e+="&v=1.0&api_key="+n.apiKey+"&response_format=json&suppress_response_codes=true",!f||n.authToken)return f&&(e+="&auth="+n.authToken),i&&(e+="&fr_id="+n.frId+"&s_trID="+n.frId),o({method:"POST",url:c,data:e,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(n){return n})}else;else;},luminateExtendRequest:function(o,c,e,f,i){if(luminateExtend){if(c)return f&&(c+="&fr_id="+n.frId+"&s_trID="+n.frId),luminateExtend.api({api:o,data:c,requiresAuth:e,callback:i||angular.noop})}else;},teamraiserRequest:function(n,o,c){return this.request("CRTeamraiserAPI",n,o,c)},luminateExtendTeamraiserRequest:function(n,o,c,e){return this.luminateExtendRequest("teamraiser",n,o,c,e)}}}]),angular.module("ahaLuminateApp").factory("TeamraiserCompanyService",["LuminateRESTService",function(n){return{getCompanies:function(o,c){var e;return e="method=getCompaniesByInfo",o&&""!==o&&(e+="&"+o),n.luminateExtendTeamraiserRequest(e,!1,!0,c)},getCompanyList:function(o,c){var e;return e="method=getCompanyList",o&&""!==o&&(e+="&"+o),n.luminateExtendTeamraiserRequest(e,!1,!0,c)}}}]),angular.module("ahaLuminateApp").factory("TeamraiserParticipantService",["LuminateRESTService",function(n){return{getParticipants:function(o,c){var e;return e="method=getParticipants",o&&""!==o&&(e+="&"+o),n.luminateExtendTeamraiserRequest(e,!1,!0,c)}}}]),angular.module("ahaLuminateApp").factory("TeamraiserTeamService",["LuminateRESTService",function(n){return{getTeams:function(o,c){var e;return e="method=getTeamsByInfo",o&&""!==o&&(e+="&"+o),n.luminateExtendTeamraiserRequest(e,!1,!0,c)}}}]),angular.module("ahaLuminateApp").directive("eqColumnHeight",["$window","$timeout",function(n,o){return{restrict:"A",link:function(c,e){var f;return f=function(){var n;return angular.element(e).css("height",""),angular.element(e).siblings("[eq-column-height]").css("height",""),n=Number(angular.element(e).css("height").replace("px","")),angular.element(e).siblings("[eq-column-height]").each(function(){var o;if(o=Number(angular.element(this).css("height").replace("px","")),o>n)return n=o}),angular.element(e).css("height",n+"px"),angular.element(e).siblings("[eq-column-height]").css("height",n+"px")},o(f,500),angular.element(n).bind("resize",function(){return f(),c.$digest()})}}}]),angular.module("ahaLuminateApp").directive("companyParticipantList",function(){return{templateUrl:"../aha-luminate/dist/heart-walk/html/directive/companyParticipantList.html",restrict:"E",replace:!0,scope:{isOpen:"=",isChildCompany:"=",companyName:"=",participants:"=",searchCompanyParticipants:"="},controller:["$scope",function(n){return n.companyParticipantSearch={participant_name:""},n.toggleCompanyParticipantList=function(){return n.isOpen=!n.isOpen}}]}}),angular.module("ahaLuminateApp").directive("companyTeamList",function(){return{templateUrl:"../aha-luminate/dist/heart-walk/html/directive/companyTeamList.html",restrict:"E",replace:!0,scope:{isOpen:"=",isChildCompany:"=",companyName:"=",teams:"=",searchCompanyTeams:"="},controller:["$scope",function(n){return n.companyTeamSearch={team_name:""},n.toggleCompanyTeamList=function(){return n.isOpen=!n.isOpen}}]}}),angular.module("ahaLuminateApp").directive("teamMemberList",function(){return{templateUrl:"../aha-luminate/dist/heart-walk/html/directive/teamMemberList.html",restrict:"E",replace:!0,scope:{teamMembers:"=",teamGiftsLabel:"=",teamGiftsAmount:"=",teamGiftsAmountFormatted:"="}}}),angular.module("ahaLuminateApp").directive("topCompanyList",function(){return{templateUrl:"../aha-luminate/dist/heart-walk/html/directive/topCompanyList.html",restrict:"E",replace:!0,scope:{companies:"=",maxSize:"="}}}),angular.module("ahaLuminateApp").directive("topParticipantList",function(){return{templateUrl:"../aha-luminate/dist/heart-walk/html/directive/topParticipantList.html",restrict:"E",replace:!0,scope:{participants:"=",maxSize:"="}}}),angular.module("ahaLuminateApp").directive("topTeamList",function(){return{templateUrl:"../aha-luminate/dist/heart-walk/html/directive/topTeamList.html",restrict:"E",replace:!0,scope:{teams:"=",maxSize:"="}}}),angular.module("ahaLuminateControllers").controller("CompanyPageCtrl",["$scope","$location","$filter","$timeout","TeamraiserCompanyService","TeamraiserTeamService","TeamraiserParticipantService",function(n,o,c,e,f,i,j){var l,r,t,u,y,C,Q,a,b,d,g,h;return n.companyId=o.absUrl().split("company_id=")[1].split("&")[0],t=angular.element(".js--default-company-summary"),C=t.find(".company-tally-container--gift-count .company-tally-ammount").text(),""===C&&(C="0"),n.companyProgress={numDonations:C},a=function(o,f){if(n.companyProgress.amountRaised=o||0,n.companyProgress.amountRaised=Number(n.companyProgress.amountRaised),n.companyProgress.amountRaisedFormatted=c("currency")(n.companyProgress.amountRaised/100,"$").replace(".00",""),n.companyProgress.goal=f||0,n.companyProgress.goal=Number(n.companyProgress.goal),n.companyProgress.goalFormatted=c("currency")(n.companyProgress.goal/100,"$").replace(".00",""),n.companyProgress.percent=2,e(function(){var o;if(o=n.companyProgress.percent,0!==n.companyProgress.goal&&(o=Math.ceil(n.companyProgress.amountRaised/n.companyProgress.goal*100)),o<2&&(o=2),o>98&&(o=98),n.companyProgress.percent=o,!n.$$phase)return n.$apply()},500),!n.$$phase)return n.$apply()},f.getCompanies("company_id="+n.companyId,{error:function(){return a()},success:function(n){var o,c;return o=null!=(c=n.getCompaniesResponse)?c.company:void 0,o?a(o.amountRaised,o.goal):a()}}),r=angular.element(".js--default-company-hierarchy"),l=r.find(".trr-td a"),n.childCompanies=[],angular.forEach(l,function(o){var c,e;if(e=angular.element(o).attr("href"),c=angular.element(o).text(),e.indexOf("company_id=")!==-1)return n.childCompanies.push({id:e.split("company_id=")[1].split("&")[0],name:c})}),Q=n.childCompanies.length+1,n.companyTeamSearch={team_name:""},n.companyTeams={isOpen:!0,page:1},h=function(o,c){if(n.companyTeams.teams=o||[],n.companyTeams.totalNumber=c||0,!n.$$phase)return n.$apply()},n.childCompanyTeams={companies:[]},y=function(o,c,e,f,i){var j,l;if(j=(null!=(l=n.childCompanyTeams.companies[o])?l.page:void 0)||0,n.childCompanyTeams.companies[o]={isOpen:!0,page:j,companyIndex:o,companyId:c||"",companyName:e||"",teams:f||[],totalNumber:i||0},!n.$$phase)return n.$apply()},d=function(o){if(n.companyProgress.numTeams=o||0,!n.$$phase)return n.$apply()},n.getCompanyTeamLists=function(){var o,e;return o=0,e=0,n.getCompanyTeams=function(){var f;return f=n.companyTeams.page-1,i.getTeams("team_company_id="+n.companyId+"&team_name="+n.companyTeamSearch.team_name+"&list_sort_column=total&list_ascending=false&list_page_size=5&list_page_offset="+f,{error:function(){if(h(),o++,o===Q)return d(e)},success:function(n){var f,i,j;if(h(),f=null!=(i=n.getTeamSearchByInfoResponse)?i.team:void 0,f&&(angular.isArray(f)||(f=[f]),angular.forEach(f,function(n){var o;if(n.amountRaised=Number(n.amountRaised),n.amountRaisedFormatted=c("currency")(n.amountRaised/100,"$").replace(".00",""),o=n.joinTeamURL)return n.joinTeamURL=o.split("/site/")[1]}),j=n.getTeamSearchByInfoResponse.totalNumberResults,h(f,j),e+=Number(j)),o++,o===Q)return d(e)}})},n.getCompanyTeams(),n.getChildCompanyTeams=function(f){var j,l,r,t,u;return j=n.childCompanies[f],l=j.id,r=j.name,t=null!=(u=n.childCompanyTeams.companies[f])?u.page:void 0,t?t--:t=0,i.getTeams("team_company_id="+l+"&team_name="+n.companyTeamSearch.team_name+"&list_sort_column=total&list_ascending=false&list_page_size=5&list_page_offset="+t,{error:function(){if(y(f,l,r),o++,o===Q)return d(e)},success:function(n){var i,j,t;if(i=null!=(j=n.getTeamSearchByInfoResponse)?j.team:void 0,i?(angular.isArray(i)||(i=[i]),angular.forEach(i,function(n){var o;if(n.amountRaised=Number(n.amountRaised),n.amountRaisedFormatted=c("currency")(n.amountRaised/100,"$").replace(".00",""),o=n.joinTeamURL)return n.joinTeamURL=o.split("/site/")[1]}),t=n.getTeamSearchByInfoResponse.totalNumberResults,y(f,l,r,i,t),e+=Number(t)):y(f,l,r),o++,o===Q)return d(e)}})},angular.forEach(n.childCompanies,function(o,c){return n.getChildCompanyTeams(c)})},n.getCompanyTeamLists(),n.searchCompanyTeams=function(o){return n.companyTeamSearch.team_name=(null!=o?o.team_name:void 0)||"",n.companyTeams.isOpen=!0,n.companyTeams.page=1,angular.forEach(n.childCompanyTeams.companies,function(o,c){return n.childCompanyTeams.companies[c].isOpen=!0,n.childCompanyTeams.companies[c].page=1}),n.getCompanyTeamLists()},n.companyParticipantSearch={participant_name:""},n.companyParticipants={isOpen:!0,page:1},g=function(o,c){if(n.companyParticipants.participants=o||[],n.companyParticipants.totalNumber=c||0,!n.$$phase)return n.$apply()},n.childCompanyParticipants={companies:[]},u=function(o,c,e,f,i){var j,l;if(j=(null!=(l=n.childCompanyParticipants.companies[o])?l.page:void 0)||0,n.childCompanyParticipants.companies[o]={isOpen:!0,page:j,companyIndex:o,companyId:c||"",companyName:e||"",participants:f||[],totalNumber:i||0},!n.$$phase)return n.$apply()},b=function(o){if(n.companyProgress.numParticipants=o||0,!n.$$phase)return n.$apply()},n.getCompanyParticipantLists=function(){var o,e;return o=0,e=0,n.getCompanyParticipants=function(){var f;return f=n.companyParticipants.page-1,j.getParticipants("team_name="+encodeURIComponent("%%%")+"&list_filter_column=team.company_id&list_filter_text="+n.companyId+"&list_sort_column=total&list_ascending=false&list_page_size=5&list_page_offset="+f,{error:function(){if(g(),o++,o===Q)return b(e)},success:function(n){var f,i,j,l;if(g(),i=null!=(j=n.getParticipantsResponse)?j.participant:void 0,i&&(angular.isArray(i)||(i=[i]),f=[],angular.forEach(i,function(n){var o,e;if(null!=(e=n.name)?e.first:void 0)return n.amountRaised=Number(n.amountRaised),n.amountRaisedFormatted=c("currency")(n.amountRaised/100,"$").replace(".00",""),o=n.donationUrl,o&&(n.donationUrl=o.split("/site/")[1]),f.push(n)}),l=n.getParticipantsResponse.totalNumberResults,g(f,l),e+=Number(l)),o++,o===Q)return b(e)}})},n.getCompanyParticipants(),n.getChildCompanyParticipants=function(f){var i,l,r,t,y;return i=n.childCompanies[f],l=i.id,r=i.name,t=null!=(y=n.childCompanyParticipants.companies[f])?y.page:void 0,t?t--:t=0,j.getParticipants("team_name="+encodeURIComponent("%%%")+"&list_filter_column=team.company_id&list_filter_text="+l+"&list_sort_column=total&list_ascending=false&list_page_size=5&list_page_offset="+t,{error:function(){if(u(f,l,r),o++,o===Q)return b(e)},success:function(n){var i,j,t,y;if(j=null!=(t=n.getParticipantsResponse)?t.participant:void 0,j?(angular.isArray(j)||(j=[j]),i=[],angular.forEach(j,function(n){var o,e;if(null!=(e=n.name)?e.first:void 0)return n.amountRaised=Number(n.amountRaised),n.amountRaisedFormatted=c("currency")(n.amountRaised/100,"$").replace(".00",""),o=n.donationUrl,o&&(n.donationUrl=o.split("/site/")[1]),i.push(n)}),y=n.getParticipantsResponse.totalNumberResults,u(f,l,r,i,y),e+=Number(y)):u(f,l,r),o++,o===Q)return b(e)}})},angular.forEach(n.childCompanies,function(o,c){return n.getChildCompanyParticipants(c)})},n.getCompanyParticipantLists(),n.searchCompanyParticipants=function(o){return n.companyParticipantSearch.participant_name=(null!=o?o.participant_name:void 0)||"",n.companyParticipants.isOpen=!0,n.companyParticipants.page=1,angular.forEach(n.childCompanyParticipants.companies,function(o,c){return n.childCompanyParticipants.companies[c].isOpen=!0,n.childCompanyParticipants.companies[c].page=1}),n.getCompanyParticipantLists()}}]),angular.module("ahaLuminateControllers").controller("GreetingPageCtrl",["$scope","$http","$timeout","$filter","TeamraiserParticipantService","TeamraiserTeamService","TeamraiserCompanyService",function(n,o,c,e,f,i,j){var l,r,t;return o.get("PageServer?pagename=getTeamraiserInfo&fr_id="+n.frId+"&response_format=json&pgwrap=n").then(function(o){var e;return e=o.data.getTeamraiserInfo,e?n.eventProgress={amountRaised:e.amountRaised,goal:e.goal}:n.eventProgress={amountRaised:0,goal:0},n.eventProgress.percent=2,c(function(){var o;return o=n.eventProgress.percent,0!==n.eventProgress.goal&&(o=Math.ceil(n.eventProgress.amountRaised/n.eventProgress.goal*100)),o<2&&(o=2),o>98&&(o=98),n.eventProgress.percent=o},500)}),n.topParticipants={},r=function(o){if(n.topParticipants.participants=o,!n.$$phase)return n.$apply()},f.getParticipants("first_name="+encodeURIComponent("%%%")+"&list_sort_column=total&list_ascending=false",{error:function(){return r([])},success:function(n){var o,c,f;return o=(null!=(c=n.getParticipantsResponse)?c.participant:void 0)||[],o?(angular.isArray(o)||(o=[o]),f=[],angular.forEach(o,function(n){var o;if(null!=(o=n.name)?o.first:void 0)return n.amountRaised=Number(n.amountRaised),n.amountRaisedFormatted=e("currency")(n.amountRaised/100,"$").replace(".00",""),f.push(n)}),r(f)):r([])}}),n.topTeams={},t=function(o){if(n.topTeams.teams=o,!n.$$phase)return n.$apply()},i.getTeams("list_sort_column=total&list_ascending=false",{error:function(){return t([])},success:function(n){var o,c,f;return c=(null!=(o=n.getTeamSearchByInfoResponse)?o.team:void 0)||[],c?(angular.isArray(c)||(c=[c]),f=[],angular.forEach(c,function(n){return n.amountRaised=Number(n.amountRaised),n.amountRaisedFormatted=e("currency")(n.amountRaised/100,"$").replace(".00",""),f.push(n)}),t(f)):t([])}}),n.topCompanies={},l=function(o){if(n.topCompanies.companies=o,!n.$$phase)return n.$apply()},j.getCompanyList("include_all_companies=true",{error:function(){return l([])},success:function(n){var o,c,f;return o=(null!=(c=n.getCompanyListResponse)?c.companyItem:void 0)||[],angular.isArray(o)||(o=[o]),f=[],angular.forEach(o,function(n){if("0"===n.parentOrgEventId)return f.push(n.companyId)}),j.getCompanies("list_sort_column=total&list_ascending=false&list_page_size=500",{error:function(){return l([])},success:function(n){var o,c,i;return o=(null!=(c=n.getCompaniesResponse)?c.company:void 0)||[],angular.isArray(o)||(o=[o]),i=[],angular.forEach(o,function(n){if(f.indexOf(n.companyId)>-1)return n.amountRaised=Number(n.amountRaised),n.amountRaisedFormatted=e("currency")(n.amountRaised/100,"$").replace(".00",""),i.push(n)}),i.sort(function(n,o){return Number(o.amountRaised)-Number(n.amountRaised)}),l(i)}})}})}]),angular.module("ahaLuminateControllers").controller("MainCtrl",["$scope",function(n){return angular.element("body").on("click",".addthis_button_facebook",function(n){return n.preventDefault()})}]),angular.module("ahaLuminateControllers").controller("PersonalPageCtrl",["$scope","$location","$timeout","TeamraiserParticipantService",function(n,o,c,e){var f;return n.participantId=o.absUrl().split("px=")[1].split("&")[0],n.participantProgress={},f=function(o,e){if(n.participantProgress.amountRaised=o||0,n.participantProgress.amountRaised=Number(n.participantProgress.amountRaised),n.participantProgress.goal=e||0,n.participantProgress.percent=2,c(function(){var o;if(o=n.participantProgress.percent,0!==n.participantProgress.goal&&(o=Math.ceil(n.participantProgress.amountRaised/n.participantProgress.goal*100)),o<2&&(o=2),o>98&&(o=98),n.participantProgress.percent=o,!n.$$phase)return n.$apply()},500),!n.$$phase)return n.$apply()},e.getParticipants("first_name="+encodeURIComponent("%%%")+"&list_filter_column=reg.cons_id&list_filter_text="+n.participantId,{error:function(){return f()},success:function(n){var o,c;return o=null!=(c=n.getParticipantsResponse)?c.participant:void 0,o?f(o.amountRaised,o.goal):f()}})}]),angular.module("ahaLuminateControllers").controller("TeamPageCtrl",["$scope","$location","$timeout","$filter","TeamraiserTeamService","TeamraiserParticipantService",function(n,o,c,e,f,i){var j,l,r,t,u;return n.teamId=o.absUrl().split("team_id=")[1].split("&")[0],n.teamProgress={},r=function(o,e){if(n.teamProgress.amountRaised=o||0,n.teamProgress.amountRaised=Number(n.teamProgress.amountRaised),n.teamProgress.goal=e||0,n.teamProgress.percent=2,c(function(){var o;if(o=n.teamProgress.percent,0!==n.teamProgress.goal&&(o=Math.ceil(n.teamProgress.amountRaised/n.teamProgress.goal*100)),o<2&&(o=2),o>98&&(o=98),n.teamProgress.percent=o,!n.$$phase)return n.$apply()},500),!n.$$phase)return n.$apply()},f.getTeams("team_id="+n.teamId,{error:function(){return r()},success:function(n){var o,c;return c=null!=(o=n.getTeamSearchByInfoResponse)?o.team:void 0,c?r(c.amountRaised,c.goal):r()}}),n.teamMembers={page:1},j=angular.element(".js--default-team-roster"),l=j.find(".team-roster-participant-row").last(),n.teamMembers.teamGiftsLabel=l.find(".team-roster-participant-name").text(),u=l.find(".team-roster-participant-raised").text(),""===u&&(u="0"),n.teamMembers.teamGiftsAmount=100*u.replace("$","").replace(/,/g,""),n.teamMembers.teamGiftsAmount=Number(n.teamMembers.teamGiftsAmount),n.teamMembers.teamGiftsAmountFormatted=e("currency")(n.teamMembers.teamGiftsAmount/100,"$").replace(".00",""),t=function(o,c){if(n.teamMembers.members=o||[],n.teamMembers.totalNumber=c||0,!n.$$phase)return n.$apply()},n.getTeamMembers=function(){var o;return o=n.teamMembers.page-1,i.getParticipants("first_name="+encodeURIComponent("%%%")+"&list_filter_column=reg.team_id&list_filter_text="+n.teamId+"&list_sort_column=total&list_ascending=false&list_page_size=4&list_page_offset="+o,{error:function(){return t()},success:function(n){var o,c,f;if(t(),f=null!=(o=n.getParticipantsResponse)?o.participant:void 0)return angular.isArray(f)||(f=[f]),c=[],angular.forEach(f,function(n){var o,f;if(null!=(f=n.name)?f.first:void 0)return n.amountRaised=Number(n.amountRaised),n.amountRaisedFormatted=e("currency")(n.amountRaised/100,"$").replace(".00",""),o=n.donationUrl,o&&(n.donationUrl=o.split("/site/")[1]),c.push(n)}),t(c,n.getParticipantsResponse.totalNumberResults)}})},n.getTeamMembers()}])}).call(this);