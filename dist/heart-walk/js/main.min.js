(function(){angular.module("ahaLuminateApp",["ngSanitize","ui.bootstrap","ahaLuminateControllers"]),angular.module("ahaLuminateControllers",[]),angular.module("ahaLuminateApp").constant("APP_INFO",{version:"1.0.0"}),angular.module("ahaLuminateApp").run(["$rootScope","APP_INFO",function(a,b){var c;if(c=angular.element("[data-aha-luminate-root]"),""!==c.data("api-key")&&(a.apiKey=c.data("api-key")),a.apiKey||new Error("AHA Luminate Framework: No Luminate Online API Key is defined."),""!==c.data("cons-id")&&(a.consId=c.data("cons-id")),""!==c.data("auth-token")&&(a.authToken=c.data("auth-token")),""!==c.data("fr-id"))return a.frId=c.data("fr-id")}]),angular.element(document).ready(function(){var a,b;a=["ahaLuminateApp"];try{angular.module("trPcApp"),a.push("trPcApp")}catch(a){b=a}try{angular.module("trPageEditApp"),a.push("trPageEditApp")}catch(a){b=a}return angular.bootstrap(document,a)}),angular.module("ahaLuminateApp").factory("LuminateRESTService",["$rootScope","$http","APP_INFO",function(a,b,c){return{request:function(c,d,e,f){if(d)if(a.apiKey){if(d+="&v=1.0&api_key="+a.apiKey+"&response_format=json&suppress_response_codes=true",!e||a.authToken)return e&&(d+="&auth="+a.authToken),f&&(d+="&fr_id="+a.frId+"&s_trID="+a.frId),b({method:"POST",url:c,data:d,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(a){return a})}else;else;},luminateExtendRequest:function(b,c,d,e,f){if(luminateExtend){if(c)return e&&(c+="&fr_id="+a.frId+"&s_trID="+a.frId),luminateExtend.api({api:b,data:c,requiresAuth:d,callback:f||angular.noop})}else;},teamraiserRequest:function(a,b,c){return this.request("CRTeamraiserAPI",a,b,c)},luminateExtendTeamraiserRequest:function(a,b,c,d){return this.luminateExtendRequest("teamraiser",a,b,c,d)}}}]),angular.module("ahaLuminateApp").factory("TeamraiserCompanyService",["LuminateRESTService",function(a){return{getCompanies:function(b,c){var d;return d="method=getCompaniesByInfo",b&&""!==b&&(d+="&"+b),a.luminateExtendTeamraiserRequest(d,!1,!0,c)},getCompanyList:function(b,c){var d;return d="method=getCompanyList",b&&""!==b&&(d+="&"+b),a.luminateExtendTeamraiserRequest(d,!1,!0,c)}}}]),angular.module("ahaLuminateApp").factory("TeamraiserParticipantService",["LuminateRESTService",function(a){return{getParticipants:function(b,c){var d;return d="method=getParticipants",b&&""!==b&&(d+="&"+b),a.luminateExtendTeamraiserRequest(d,!1,!0,c)}}}]),angular.module("ahaLuminateApp").factory("TeamraiserTeamService",["LuminateRESTService",function(a){return{getTeams:function(b,c){var d;return d="method=getTeamsByInfo",b&&""!==b&&(d+="&"+b),a.luminateExtendTeamraiserRequest(d,!1,!0,c)}}}]),angular.module("ahaLuminateApp").directive("eqColumnHeight",["$window","$timeout",function(a,b){return{restrict:"A",link:function(c,d){var e;return e=function(){var a;return angular.element(d).css("height",""),angular.element(d).siblings("[eq-column-height]").css("height",""),a=Number(angular.element(d).css("height").replace("px","")),angular.element(d).siblings("[eq-column-height]").each(function(){var b;if(b=Number(angular.element(this).css("height").replace("px","")),b>a)return a=b}),angular.element(d).css("height",a+"px"),angular.element(d).siblings("[eq-column-height]").css("height",a+"px")},b(e,500),angular.element(a).bind("resize",function(){return e(),c.$digest()})}}}]),angular.module("ahaLuminateApp").directive("companyParticipantList",function(){return{templateUrl:"../aha-luminate/dist/heart-walk/html/directive/companyParticipantList.html",restrict:"E",replace:!0,scope:{isChildCompany:"=",companyName:"=",participants:"="}}}),angular.module("ahaLuminateApp").directive("companyTeamList",function(){return{templateUrl:"../aha-luminate/dist/heart-walk/html/directive/companyTeamList.html",restrict:"E",replace:!0,scope:{isChildCompany:"=",companyName:"=",teams:"="}}}),angular.module("ahaLuminateApp").directive("teamMemberList",function(){return{templateUrl:"../aha-luminate/dist/heart-walk/html/directive/teamMemberList.html",restrict:"E",replace:!0,scope:{teamMembers:"=",teamGiftsLabel:"=",teamGiftsAmount:"="}}}),angular.module("ahaLuminateApp").directive("topCompanyList",function(){return{templateUrl:"../aha-luminate/dist/heart-walk/html/directive/topCompanyList.html",restrict:"E",replace:!0,scope:{companies:"=",maxSize:"="}}}),angular.module("ahaLuminateApp").directive("topParticipantList",function(){return{templateUrl:"../aha-luminate/dist/heart-walk/html/directive/topParticipantList.html",restrict:"E",replace:!0,scope:{participants:"=",maxSize:"="}}}),angular.module("ahaLuminateApp").directive("topTeamList",function(){return{templateUrl:"../aha-luminate/dist/heart-walk/html/directive/topTeamList.html",restrict:"E",replace:!0,scope:{teams:"=",maxSize:"="}}}),angular.module("ahaLuminateControllers").controller("CompanyPageCtrl",["$scope","$location","TeamraiserCompanyService","TeamraiserTeamService","TeamraiserParticipantService",function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;return a.companyId=b.absUrl().split("company_id=")[1].split("&")[0],h=angular.element(".js--default-company-summary"),k=h.find(".company-tally-container--gift-count .company-tally-ammount").text(),""===k&&(k="0"),a.companyProgress={numDonations:k},q=function(b,c){if(a.companyProgress.amountRaised=b||"0",a.companyProgress.goal=c||"0",!a.$$phase)return a.$apply()},c.getCompanies("company_id="+a.companyId,{error:function(){return q()},success:function(a){var b,c;return b=null!=(c=a.getCompaniesResponse)?c.company:void 0,b?q(b.amountRaised,b.goal):q()}}),g=angular.element(".js--default-company-hierarchy"),f=g.find(".trr-td a"),a.childCompanies=[],angular.forEach(f,function(b){var c,d;if(d=angular.element(b).attr("href"),c=angular.element(b).text(),d.indexOf("company_id=")!==-1)return a.childCompanies.push({id:d.split("company_id=")[1].split("&")[0],name:c})}),l=a.childCompanies.length+1,a.companyTeams={page:1},u=function(b,c){if(a.companyTeams.teams=b||[],a.companyTeams.totalNumber=c||0,!a.$$phase)return a.$apply()},a.childCompanyTeams={companies:[]},j=function(b,c,d,e,f){var g,h;if(g=(null!=(h=a.childCompanyTeams.companies[b])?h.page:void 0)||0,a.childCompanyTeams.companies[b]={page:g,companyIndex:b,companyId:c||"",companyName:d||"",teams:e||[],totalNumber:f||0},!a.$$phase)return a.$apply()},s=function(b){if(a.companyProgress.numTeams=b||0,!a.$$phase)return a.$apply()},n=0,p=0,a.getCompanyTeams=function(){var b;return b=a.companyTeams.page-1,d.getTeams("team_company_id="+a.companyId+"&list_sort_column=total&list_ascending=false&list_page_size=5&list_page_offset="+b,{error:function(){if(u(),n++,n===l)return s(p)},success:function(a){var b,c,d;if(u(),b=null!=(c=a.getTeamSearchByInfoResponse)?c.team:void 0,b&&(angular.isArray(b)||(b=[b]),angular.forEach(b,function(a){var b;if(b=a.joinTeamURL)return a.joinTeamURL=b.split("/site/")[1]}),d=a.getTeamSearchByInfoResponse.totalNumberResults,u(b,d),p+=Number(d)),n++,n===l)return s(p)}})},a.getCompanyTeams(),a.getChildCompanyTeams=function(b){var c,e,f,g,h;return c=a.childCompanies[b],e=c.id,f=c.name,g=null!=(h=a.childCompanyTeams.companies[b])?h.page:void 0,g?g--:g=0,d.getTeams("team_company_id="+e+"&list_sort_column=total&list_ascending=false&list_page_size=5&list_page_offset="+g,{error:function(){if(j(b,e,f),n++,n===l)return s(p)},success:function(a){var c,d,g;if(c=null!=(d=a.getTeamSearchByInfoResponse)?d.team:void 0,c?(angular.isArray(c)||(c=[c]),angular.forEach(c,function(a){var b;if(b=a.joinTeamURL)return a.joinTeamURL=b.split("/site/")[1]}),g=a.getTeamSearchByInfoResponse.totalNumberResults,j(b,e,f,c,g),p+=Number(g)):j(b,e,f),n++,n===l)return s(p)}})},angular.forEach(a.childCompanies,function(b,c){return a.getChildCompanyTeams(c)}),a.companyParticipants={page:1},t=function(b,c){if(a.companyParticipants.participants=b||[],a.companyParticipants.totalNumber=c||0,!a.$$phase)return a.$apply()},a.childCompanyParticipants={companies:[]},i=function(b,c,d,e,f){var g,h;if(g=(null!=(h=a.childCompanyParticipants.companies[b])?h.page:void 0)||0,a.childCompanyParticipants.companies[b]={page:g,companyIndex:b,companyId:c||"",companyName:d||"",participants:e||[],totalNumber:f||0},!a.$$phase)return a.$apply()},r=function(b){if(a.companyProgress.numParticipants=b||0,!a.$$phase)return a.$apply()},m=0,o=0,a.getCompanyParticipants=function(){var b;return b=a.companyParticipants.page-1,e.getParticipants("team_name="+encodeURIComponent("%%%")+"&list_filter_column=team.company_id&list_filter_text="+a.companyId+"&list_sort_column=total&list_ascending=false&list_page_size=5&list_page_offset="+b,{error:function(){if(t(),m++,m===l)return r(o)},success:function(a){var b,c,d;if(t(),b=null!=(c=a.getParticipantsResponse)?c.participant:void 0,b&&(angular.isArray(b)||(b=[b]),angular.forEach(b,function(a){var b;if(b=a.donationUrl)return a.donationUrl=b.split("/site/")[1]}),d=a.getParticipantsResponse.totalNumberResults,t(b,d),o+=Number(d)),m++,m===l)return r(o)}})},a.getCompanyParticipants(),a.getChildCompanyParticipants=function(b){var c,d,f,g,h;return c=a.childCompanies[b],d=c.id,f=c.name,g=null!=(h=a.childCompanyParticipants.companies[b])?h.page:void 0,g?g--:g=0,e.getParticipants("team_name="+encodeURIComponent("%%%")+"&list_filter_column=team.company_id&list_filter_text="+d+"&list_sort_column=total&list_ascending=false&list_page_size=5&list_page_offset="+g,{error:function(){if(i(b,d,f),m++,m===l)return r(o)},success:function(a){var c,e,g;if(c=null!=(e=a.getParticipantsResponse)?e.participant:void 0,c?(angular.isArray(c)||(c=[c]),angular.forEach(c,function(a){var b;if(b=a.donationUrl)return a.donationUrl=b.split("/site/")[1]}),g=a.getParticipantsResponse.totalNumberResults,i(b,d,f,c,g),o+=Number(g)):i(b,d,f),m++,m===l)return r(o)}})},angular.forEach(a.childCompanies,function(b,c){return a.getChildCompanyParticipants(c)})}]),angular.module("ahaLuminateControllers").controller("GreetingPageCtrl",["$scope","TeamraiserParticipantService","TeamraiserTeamService","TeamraiserCompanyService",function(a,b,c,d){var e,f,g;return a.topParticipants={},f=function(b){if(a.topParticipants.participants=b,!a.$$phase)return a.$apply()},b.getParticipants("first_name="+encodeURIComponent("%%%")+"&list_sort_column=total&list_ascending=false",{error:function(){return f([])},success:function(a){var b;return b=a.getParticipantsResponse.participant||[],angular.isArray(b)||(b=[b]),f(b)}}),a.topTeams={},g=function(b){if(a.topTeams.teams=b,!a.$$phase)return a.$apply()},c.getTeams("list_sort_column=total&list_ascending=false",{error:function(){return g([])},success:function(a){var b;return b=a.getTeamSearchByInfoResponse.team||[],angular.isArray(b)||(b=[b]),g(b)}}),a.topCompanies={},e=function(b){if(a.topCompanies.companies=b,!a.$$phase)return a.$apply()},d.getCompanyList("include_all_companies=true",{error:function(){return e([])},success:function(a){var b,c;return b=a.getCompanyListResponse.companyItem||[],angular.isArray(b)||(b=[b]),c=[],angular.forEach(b,function(a){if("0"===a.parentOrgEventId)return c.push(a.companyId)}),d.getCompanies("list_sort_column=total&list_ascending=false&list_page_size=500",{error:function(){return e([])},success:function(a){var b,d;return b=a.getCompaniesResponse.company||[],angular.isArray(b)||(b=[b]),d=[],angular.forEach(b,function(a){if(c.indexOf(a.companyId)>-1)return d.push(a)}),d.sort(function(a,b){return Number(b.amountRaised)-Number(a.amountRaised)}),e(d)}})}})}]),angular.module("ahaLuminateControllers").controller("MainCtrl",["$scope",function(a){return angular.element("body").on("click",".addthis_button_facebook",function(a){return a.preventDefault()})}]),angular.module("ahaLuminateControllers").controller("PersonalPageCtrl",["$scope",function(a){}]),angular.module("ahaLuminateControllers").controller("TeamPageCtrl",["$scope","$location","TeamraiserParticipantService",function(a,b,c){var d,e,f,g;return a.teamId=b.absUrl().split("team_id=")[1].split("&")[0],a.teamMembers={page:1},d=angular.element(".js--default-team-roster"),e=d.find(".team-roster-participant-row").last(),a.teamMembers.teamGiftsLabel=e.find(".team-roster-participant-name").text(),g=e.find(".team-roster-participant-raised").text(),""===g&&(g="0"),a.teamMembers.teamGiftsAmount=100*g.replace("$","").replace(/,/g,""),f=function(b,c){if(a.teamMembers.members=b||[],a.teamMembers.totalNumber=c||0,!a.$$phase)return a.$apply()},a.getTeamMembers=function(){var b;return b=a.teamMembers.page-1,c.getParticipants("first_name="+encodeURIComponent("%%%")+"&list_filter_column=reg.team_id&list_filter_text="+a.teamId+"&list_sort_column=total&list_ascending=false&list_page_size=4&list_page_offset="+b,{error:function(){return f()},success:function(a){var b,c,d;if(f(),d=null!=(b=a.getParticipantsResponse)?b.participant:void 0)return angular.isArray(d)||(d=[d]),c=[],angular.forEach(d,function(a){var b,d;if(null!=(d=a.name)?d.first:void 0)return b=a.donationUrl,b&&(a.donationUrl=b.split("/site/")[1]),c.push(a)}),f(c,a.getParticipantsResponse.totalNumberResults)}})},a.getTeamMembers()}])}).call(this);